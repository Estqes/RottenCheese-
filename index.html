<!doctype html>
<html lang="ru" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ì–Ω–∏–ª–æ–π –°—ã—Ä - –•—É–¥—à–∞—è –∏–≥—Ä–∞ –≥–æ–¥–∞</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <link rel="JSON" href="games.json"/>
</head>
<body class="modern-bg">
  <nav class="navbar navbar-expand-lg fixed-top glass-navbar">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="cheese.svg" alt="–õ–æ–≥–æ" width="48" class="me-2 pulse-icon">
        <span class="h3 mb-0 fw-bold text-gradient">–ì–Ω–∏–ª–æ–π –°—ã—Ä</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link active" href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
          <li class="nav-item"><a class="nav-link" href="2.html">–ù–æ–º–∏–Ω–∞—Ü–∏–∏ 2023</a></li>
          <li class="nav-item"><a class="nav-link" href="#vote">–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container pt-120">
    <div class="row text-center mb-5 animate__animated animate__fadeIn">
      <div class="col-12">
        <h1 class="display-3 fw-bold mb-3 text-gradient">–ì–Ω–∏–ª–æ–π –°—ã—Ä 2024</h1>
        <p class="lead text-muted">–ü—Ä–µ–º–∏—è –∑–∞ —Å–∞–º—ã–µ —Ä–∞–∑–æ—á–∞—Ä–æ–≤—ã–≤–∞—é—â–∏–µ –∏–≥—Ä—ã –≥–æ–¥–∞</p>
      </div>
    </div>

    <div class="row g-4 mb-5">
      <div class="col-md-6">
        <div class="modern-card hover-transform">
          <div class="card-body">
            <h3 class="text-accent mb-4">‚òÖ –ê–Ω—Ç–∏-–ø—Ä–µ–º–∏—è –≤ –∏–≥—Ä–æ–≤–æ–π –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ ‚òÖ</h3>
            <p class="text-main">–ö–∞–∂–¥—ã–π –≥–æ–¥ –º—ã –≤—ã–±–∏—Ä–∞–µ–º –∏–≥—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–ª–∏ –∏–≥—Ä–æ–∫–æ–≤. 
              –ì–æ–ª–æ—Å—É–π—Ç–µ –∑–∞ –ø—Ä–æ–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–ª–∏ –æ–∂–∏–¥–∞–Ω–∏–π, –∏–º–µ–ª–∏ —Ö—É–¥—à—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é 
              –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ–∫–∞–∑–∞–ª–∏—Å—å –ø—Ä–æ–≤–∞–ª—å–Ω—ã–º–∏!</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="modern-card hover-transform">
          <div class="card-body">
            <h3 class="text-accent mb-4">ìÜ∞ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–±–æ—Ä–∞ ìÜ∞</h3>
            <ul class="text-main">
              <li>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã</li>
              <li>–û–±–µ—â–∞–Ω–∏—è vs –†–µ–∞–ª—å–Ω–æ—Å—Ç—å</li>
              <li>–ò–≥—Ä–æ–∫–∏-—Ä–µ—Ü–µ–Ω–∑–µ–Ω—Ç—ã –Ω–∞ Metacritic</li>
              <li>–°–æ–æ–±—â–µ—Å—Ç–≤–æ Steam</li>
              <li>–ú–µ–º-–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –ø—Ä–æ–≤–∞–ª–∞</li>
              <li>–õ–∏–¥–µ—Ä –ø–æ –∏–Ω–∫–ª—é–∑–∏–≤–Ω–æ—Å—Ç–∏</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div id="vote" class="row mb-5">
      <div class="col-12 text-center">
        <h2 class="text-accent mb-5">–¢–æ–ø-–Ω–æ–º–∏–Ω–∞–Ω—Ç–æ–≤ —ç—Ç–æ–≥–æ –≥–æ–¥–∞</h2>
        <div class="row g-4">
          <div class="col-lg-3 col-md-6">
            <div class="modern-card game-card hover-transform">
              <img src="game1.jpg" class="card-img-top" alt="–ò–≥—Ä–∞ 1">
              <div class="card-body">
                <h5 class="text-accent">CyberBug 2077</h5>
                <p class="text-main">–û–±–µ—â–∞–Ω–Ω—ã–π —à–µ–¥–µ–≤—Ä, –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è –∫–æ–∫—Ç–µ–π–ª–µ–º –∏–∑ –±–∞–≥–æ–≤</p>
                <button class="btn btn-accent w-100">–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å</button>
              </div>
            </div>
          </div>
          <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä -->
        </div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const gamesContainer = document.querySelector('#vote .row.g-4');
      try {
        // 1. –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
        const response = await fetch('games.json');

        // 2. –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–≤–µ—Ç–∞
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º Content-Type
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          throw new Error('Invalid content type');
        }

        const data = await response.json();

        // 4. –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
        if (!data.games || !Array.isArray(data.games)) {
          throw new Error('Invalid data format');
        }

        // 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
        gamesContainer.innerHTML = data.games.map(game => `
          <div class="col-lg-3 col-md-6">
            <div class="modern-card game-card hover-transform">
              <img src="${game.image}" 
                  class="card-img-top" 
                  alt="${game.title}"
                  loading="lazy">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5 class="text-accent mb-0">${game.title}</h5>
                  <span class="badge bg-accent">${game.votes ?? 0} –≥–æ–ª–æ—Å–æ–≤</span>
                </div>
                <p class="text-main">${game.description ?? '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</p>
                <button class="btn btn-accent w-100" 
                        data-id="${game.id}"
                        ${game.disabled ? 'disabled' : ''}>
                  ${game.buttonText || '–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å'}
                </button>
              </div>
            </div>
          </div>
        `).join('');

        // 6. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
        if (gamesContainer.children.length > 0) {
          document.querySelectorAll('[data-id]').forEach(btn => {
            btn.addEventListener('click', handleVote);
          });
        }

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        gamesContainer.innerHTML = `
          <div class="col-12 text-center text-accent">
            <p>‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>
            <small>${error.message}</small>
          </div>
        `;
      }
    });

    // 7. –£–ª—É—á—à–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
    async function handleVote(e) {
      const btn = e.target;
      const gameId = btn.dataset.id;
      
      try {
        btn.disabled = true;
        btn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

        // 8. –ü—Ä–∏–º–µ—Ä POST-–∑–∞–ø—Ä–æ—Å–∞
        const response = await fetch('/api/vote', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ gameId })
        });

        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
        
        btn.textContent = '‚úÖ –ì–æ–ª–æ—Å —É—á—Ç–µ–Ω!';
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≥–æ–ª–æ—Å–æ–≤
        const badge = btn.closest('.card-body').querySelector('.badge');
        badge.textContent = `${parseInt(badge.textContent) + 1} –≥–æ–ª–æ—Å–æ–≤`;

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        btn.textContent = '‚ùå –û—à–∏–±–∫–∞';
        setTimeout(() => {
          btn.disabled = false;
          btn.textContent = '–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å';
        }, 2000);
      }
    }
  </script>
</body>
</html>